# Phase 8: Unified Post-Interview Analytics

This feature adds a **tabbed analytics view** after each interview, combining candidate performance, interviewer quality, and transcript in one place.

---

## Overview

After an interview ends, users see a 3-tab analytics panel:

| Tab | Content |
|-----|---------|
| **Candidate Analytics** | How well the candidate performed (scores, Q&A breakdown, recommendation) |
| **Interviewer Analytics** | How well the interviewer performed (question quality, topic coverage, bias) |
| **Transcript** | Full conversation with speaker labels |

---

## User Flow

```
[Interview Ends]
       ↓
[Post-Interview Panel Slides In]
       ↓
┌─────────────────────────────────────────────────┐
│  [ Candidate ✓ ]  [ Interviewer ]  [ Transcript ]  │
├─────────────────────────────────────────────────┤
│                                                 │
│       (Currently showing Candidate tab)         │
│                                                 │
└─────────────────────────────────────────────────┘
```

- Default tab: **Candidate Analytics**
- Selected tab persists via `sessionStorage` during the session

---

## Tab 1: Candidate Analytics (Existing)

This is the current post-interview view. No changes needed.

**Displays:**
- Overall score (0-100)
- Hiring recommendation (Strong Hire / Hire / No Hire)
- Q&A pairs with per-question scores
- Red flags and highlights
- Suggested follow-up questions

---

## Tab 2: Interviewer Analytics (New)

**Purpose:** Show how well the **interviewer** performed in this specific interview.

### Metrics

| Metric | Description | Score Range |
|--------|-------------|-------------|
| Question Quality | Relevance, depth, and follow-up quality | 0-100 |
| Topic Coverage | Did they cover all key areas? | 0-100 |
| Consistency | Scoring alignment with other interviewers | 0-100 |
| Bias Score | Lower is better - detects leading questions, imbalance | 0-100 |
| Candidate Experience | Pace, clarity, fairness | 0-100 |

### Topic Coverage Breakdown

Shows coverage across four dimensions:
- Technical
- Behavioral
- Culture Fit
- Problem Solving

### Bias Indicators

If detected, show flags like:
- "Leading questions detected"
- "Candidate spoke only 35% of the time"
- "Multiple interruptions observed"

### Improvement Suggestions

Actionable tips generated by the LLM:
- "Consider more open-ended questions"
- "Increase behavioral question coverage"

---

## Tab 3: Transcript

**Purpose:** Full interview transcript for reference.

**Features:**
- Speaker labels (Interviewer / Candidate)
- Turn-by-turn conversation
- Scrollable with search (future enhancement)

**Data Source Priority:**
1. `transcripts` table in Supabase (preferred)
2. In-memory transcript from interview state (if page not refreshed)
3. Local file fallback: `data/transcripts/{candidate_id}_{timestamp}.txt`

---

## Backend Requirements

### New Endpoint

```
GET /api/interviewers/interviews/{interview_id}/analytics
```

**Response:**
```json
{
  "interviewer": {
    "id": "uuid",
    "name": "Arsene Wenger"
  },
  "analytics": {
    "question_quality_score": 78,
    "topic_coverage_score": 65,
    "consistency_score": 82,
    "bias_score": 15,
    "candidate_experience_score": 88,
    "overall_score": 76,
    "question_quality_breakdown": {
      "relevance": 8,
      "depth": 7,
      "follow_up_quality": 8
    },
    "topics_covered": {
      "technical": 80,
      "behavioral": 40,
      "culture_fit": 70,
      "problem_solving": 60
    },
    "bias_indicators": {
      "flags": ["Candidate had limited speaking time"],
      "severity": "low"
    },
    "improvement_suggestions": [
      "Increase behavioral question coverage",
      "Allow candidate more time to elaborate"
    ]
  }
}
```

### Existing Endpoints Used

| Endpoint | Purpose |
|----------|---------|
| `POST /api/analytics/{room_name}` | Generate candidate analytics |
| `GET /api/interviewers/{id}/analytics` | Aggregated interviewer stats (Dashboard) |
| `GET /api/interviews/{id}` | Get interview details including transcript |

---

## Frontend Components

### Modified: `interview/page.tsx`

- Add tab bar component above analytics content
- Manage tab state with `sessionStorage`
- Conditionally render tab content

### New: `InterviewerAnalyticsTab.tsx`

```tsx
interface Props {
  interviewId: string;
}

export default function InterviewerAnalyticsTab({ interviewId }: Props) {
  // Fetch interviewer analytics for this interview
  // Display score cards, topic breakdown, suggestions
}
```

### New: `TranscriptTab.tsx`

```tsx
interface Props {
  transcript: { speaker: string; text: string; timestamp?: number }[];
}

export default function TranscriptTab({ transcript }: Props) {
  // Render scrollable transcript with speaker labels
}
```

---

## Database Schema

Uses existing `interviewer_analytics` table:

```sql
CREATE TABLE interviewer_analytics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    interview_id UUID REFERENCES interviews(id),
    interviewer_id UUID REFERENCES hiring_managers(id),
    
    question_quality_score INT,
    topic_coverage_score INT,
    consistency_score INT,
    bias_score INT,
    candidate_experience_score INT,
    overall_score INT,
    
    question_quality_breakdown JSONB,
    topics_covered JSONB,
    bias_indicators JSONB,
    improvement_suggestions TEXT[],
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## Implementation Checklist

### Backend
- [ ] Add `GET /api/interviewers/interviews/{interview_id}/analytics` endpoint
- [ ] Ensure `interviewer_analytics` is populated when interview ends

### Frontend
- [ ] Add tab bar to post-interview analytics panel
- [ ] Implement `sessionStorage` for tab persistence
- [ ] Create `InterviewerAnalyticsTab.tsx` component
- [ ] Create `TranscriptTab.tsx` component
- [ ] Style tabs to match existing dark theme

### Testing
- [ ] Verify tabs switch correctly
- [ ] Verify tab persists on refresh (session only)
- [ ] Verify fallback when interviewer analytics not available
- [ ] Verify transcript renders correctly

---

## Future Enhancements

- **Timestamp links:** Click on transcript turn to jump to audio playback
- **Searchable transcript:** Filter/search within transcript
- **Comparison view:** Compare this interview's interviewer stats to their average
- **Export:** Download transcript as PDF or TXT
